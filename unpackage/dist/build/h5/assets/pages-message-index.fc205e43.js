import{r as e,p as a,j as l,o as s,c as t,w as r,d as i,e as n,a as u,F as c,b as d,f as o,l as f,i as _,S as v,q as p,t as g,u as h,n as y,x as m,g as k,y as b,h as x,v as w,z as C}from"./index-78b71ae6.js";import{_ as S,a as j}from"./uni-list.a8b51052.js";import{r as $}from"./uni-app.es.27f7652a.js";import{u as F}from"./uni-fetch.281d61b3.js";import{_ as R}from"./_plugin-vue_export-helper.1b428a4d.js";import"./user.ccf31787.js";const I=(e,a=1,l=5)=>F.get("/driver/messages/page",{contentType:e,page:a,pageSize:l}),T=e=>F.put(`/driver/messages/readAll/${e}`),B=R({__name:"announce",setup(p){const g=e(0),h=e(5),y=e([]),m=e(!1),k=e(!1),b=e(!1),x=e("200"),w=async()=>{g.value+=1;const e=await I(x.value,g.value,h.value);1===g.value&&(y.value=[]),y.value=[...y.value,...e.data.items||[]],k.value=g.value==e.data.pages,m.value=0===y.value.length};a((()=>{w()}));const C=()=>{k.value||w()},F=async()=>{b.value=!0,g.value=0,await w(),b.value=!1},R=async()=>{try{await T(x.value);g.value=0,w()}catch(e){console.log(e)}};return(e,a)=>{const p=f,g=_,h=$(l("uni-list-item"),S),k=$(l("uni-list"),j),x=v;return s(),t(x,{"refresher-triggered":b.value,onRefresherrefresh:F,"refresher-enabled":!0,onScrolltolower:C,"scroll-y":"true",class:"scroll-view","refresher-background":"#f4f4f4;"},{default:r((()=>[y.value.length>0?(s(),t(g,{key:0,class:"scroll-view-wrapper"},{default:r((()=>[i(g,{class:"announce"},{default:r((()=>[i(g,{class:"message-action",onClick:R},{default:r((()=>[i(p,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),i(k,null,{default:r((()=>[(s(!0),u(c,null,d(y.value,((e,a)=>(s(),t(h,{key:e.id,title:e.title,"right-text":e.created,ellipsis:"1",to:`/subpkg_message/content/index?id=${e.id}`},{header:r((()=>[0===e.isRead?(s(),t(p,{key:0,class:"dot"})):o("",!0)])),_:2},1032,["title","right-text","to"])))),128))])),_:1})])),_:1}),m.value?(s(),t(g,{key:0,class:"message-blank"},{default:r((()=>[n("暂无消息")])),_:1})):o("",!0)])),_:1})):o("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-406fafe7"]]);const q=R({name:"UniCard",emits:["click"],props:{title:{type:String,default:""},subTitle:{type:String,default:""},padding:{type:String,default:"10px"},margin:{type:String,default:"15px"},spacing:{type:String,default:"0 10px"},extra:{type:String,default:""},cover:{type:String,default:""},thumbnail:{type:String,default:""},isFull:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!0},shadow:{type:String,default:"0px 0px 3px 1px rgba(0, 0, 0, 0.08)"},border:{type:Boolean,default:!0}},methods:{onClick(e){this.$emit("click",e)}}},[["render",function(e,a,l,u,c,d){const v=m,k=_,b=f;return s(),t(k,{class:y(["uni-card",{"uni-card--full":l.isFull,"uni-card--shadow":l.isShadow,"uni-card--border":l.border}]),style:h({margin:l.isFull?0:l.margin,padding:l.spacing,"box-shadow":l.isShadow?l.shadow:""})},{default:r((()=>[p(e.$slots,"cover",{},(()=>[l.cover?(s(),t(k,{key:0,class:"uni-card__cover"},{default:r((()=>[i(v,{class:"uni-card__cover-image",mode:"widthFix",onClick:a[0]||(a[0]=e=>d.onClick("cover")),src:l.cover},null,8,["src"])])),_:1})):o("",!0)]),!0),p(e.$slots,"title",{},(()=>[l.title||l.extra?(s(),t(k,{key:0,class:"uni-card__header"},{default:r((()=>[i(k,{class:"uni-card__header-box",onClick:a[1]||(a[1]=e=>d.onClick("title"))},{default:r((()=>[l.thumbnail?(s(),t(k,{key:0,class:"uni-card__header-avatar"},{default:r((()=>[i(v,{class:"uni-card__header-avatar-image",src:l.thumbnail,mode:"aspectFit"},null,8,["src"])])),_:1})):o("",!0),i(k,{class:"uni-card__header-content"},{default:r((()=>[i(b,{class:"uni-card__header-content-title uni-ellipsis"},{default:r((()=>[n(g(l.title),1)])),_:1}),l.title&&l.subTitle?(s(),t(b,{key:0,class:"uni-card__header-content-subtitle uni-ellipsis"},{default:r((()=>[n(g(l.subTitle),1)])),_:1})):o("",!0)])),_:1})])),_:1}),i(k,{class:"uni-card__header-extra",onClick:a[2]||(a[2]=e=>d.onClick("extra"))},{default:r((()=>[i(b,{class:"uni-card__header-extra-text"},{default:r((()=>[n(g(l.extra),1)])),_:1})])),_:1})])),_:1})):o("",!0)]),!0),i(k,{class:"uni-card__content",style:h({padding:l.padding}),onClick:a[3]||(a[3]=e=>d.onClick("content"))},{default:r((()=>[p(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),i(k,{class:"uni-card__actions",onClick:a[4]||(a[4]=e=>d.onClick("actions"))},{default:r((()=>[p(e.$slots,"actions",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}],["__scopeId","data-v-b4135a35"]]),z=R({__name:"notify",setup(p){const h=e(0),m=e(5),b=e([]),x=e(!1),w=e(!1),C=e(!1),S=e("201"),j=async()=>{h.value+=1;const e=await I(S.value,h.value,m.value);1===h.value&&(b.value=[]),b.value=[...b.value,...e.data.items||[]],w.value=h.value==e.data.pages,x.value=0===b.value.length};a((()=>{j()}));const F=()=>{w.value||j()},R=async()=>{C.value=!0,h.value=0,await j(),C.value=!1},B=async()=>{try{await T(S.value);h.value=0,j()}catch(e){console.log(e)}};return(e,a)=>{const p=f,h=_,m=k,S=$(l("uni-card"),q),j=v;return s(),t(j,{"refresher-triggered":C.value,onRefresherrefresh:R,"refresher-enabled":"",onScrolltolower:F,"scroll-y":"true",class:"scroll-view","refresher-background":"#f4f4f4;"},{default:r((()=>[b.value.length>0?(s(),t(h,{key:0,class:"scroll-view-wrapper"},{default:r((()=>[i(h,{class:"nofity"},{default:r((()=>[i(h,{class:"message-action",onClick:B},{default:r((()=>[i(p,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),(s(!0),u(c,null,d(b.value,(e=>(s(),t(S,{key:e.id,border:!1,"is-shadow":!1},{title:r((()=>[i(h,{class:y([{unread:!e.isRead},"title unread"])},{default:r((()=>[n(" 您有新的运输任务 "),0===e.isRead?(s(),t(p,{key:0,class:"dots"})):o("",!0)])),_:2},1032,["class"])])),default:r((()=>[i(h,{class:"brief"},{default:r((()=>[n(g(e.content),1)])),_:2},1024),i(h,{class:"extra"},{default:r((()=>[i(p,{class:"time"},{default:r((()=>[n(g(e.created),1)])),_:2},1024),i(m,{"hover-class":"none",class:"link",url:`/subpkg_task/detail/index?id=${e.id}`},{default:r((()=>[n("查看详情")])),_:2},1032,["url"])])),_:2},1024)])),_:2},1024)))),128)),w.value?(s(),t(h,{key:0,class:"tips"},{default:r((()=>[n("已经到达底部了~")])),_:1})):o("",!0)])),_:1}),x.value?(s(),t(h,{key:0,class:"message-blank"},{default:r((()=>[n("暂无消息")])),_:1})):o("",!0)])),_:1})):o("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-d6468c21"]]),A=R({__name:"index",setup(a){const l=e(0),f=b([{title:"公告",rendered:!0},{title:"任务通知",rendered:!1}]);return(e,a)=>{const v=_;return s(),t(v,{class:"message"},{default:r((()=>[i(v,{class:"message-tabbar"},{default:r((()=>[(s(!0),u(c,null,d(f,((e,a)=>(s(),t(v,{key:a,onClick:e=>(e=>{f[e].rendered=!0,l.value=e})(a),class:"tab-item"},{default:r((()=>[i(v,{class:y(["title",{active:l.value===a}])},{default:r((()=>[n(g(e.title),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),f[0].rendered?x((s(),t(v,{key:0,class:"message-list"},{default:r((()=>[i(C(B))])),_:1},512)),[[w,0===l.value]]):o("",!0),f[1].rendered?x((s(),t(v,{key:1,class:"message-list"},{default:r((()=>[i(C(z))])),_:1},512)),[[w,1===l.value]]):o("",!0)])),_:1})}}},[["__scopeId","data-v-14d65306"]]);export{A as default};
