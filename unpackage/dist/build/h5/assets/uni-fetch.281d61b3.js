import{a0 as e,a1 as t,a2 as n,a3 as s,k as r}from"./index-78b71ae6.js";import{u as a}from"./user.ccf31787.js";var i={};Object.defineProperty(i,"__esModule",{value:!0});var o=i.createUniFetch=void 0;function u(s){var r,a;const i=[],o=s=>(!s.url.startsWith("http")&&o.baseURL&&(s.url=o.baseURL+s.url),o.intercept.request(s),(null==o?void 0:o.loading)&&!i.length&&e(Object.assign({},o.loading)),i.push("loading"),new Promise(((e,r)=>{t(Object.assign(Object.assign({},s),{success:t=>{e(o.intercept.response(Object.assign(Object.assign({},t),{config:s})))},fail:r,complete:()=>{i.pop(),i.length||n()}}))})));return o.loading=null==s?void 0:s.loading,o.baseURL=null==s?void 0:s.baseURL,o.intercept={request:e=>e,response:e=>e},(null===(r=null==s?void 0:s.intercept)||void 0===r?void 0:r.request)&&(o.intercept.request=s.intercept.request),(null===(a=null==s?void 0:s.intercept)||void 0===a?void 0:a.response)&&(o.intercept.response=s.intercept.response),o.get=function(e,t={}){return o({url:e,method:"GET",data:t})},o.post=function(e,t={}){return o({url:e,method:"POST",data:t})},o.put=function(e,t={}){return o({url:e,method:"PUT",data:t})},o.delete=function(e,t){return o({url:e,method:"DELETE",data:t})},o}o=i.createUniFetch=u,i.default=u();const d=["pages/task/index","pages/message/index","pages/my/index"],l=o({loading:{title:"加载中..."},baseURL:"/dev-api",intercept:{request(e){const t={Authorization:a().token};return e.header=Object.assign({},t,e.header),e},response(e){if(200===e.statusCode&&200===e.data.code)return e.data;if(401===e.statusCode){const e=s();console.log("pageStack=>",e);const t=e[e.length-1].route,n=d.includes(t)?"switchTab":"redirectTo";return r({url:`/pages/login/index?routeType=${n}&redirectUrl=/${t}`})}uni.utils.toast(e.data.msg||"请求失败")}}});export{l as u};
